<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–∏—Ç–æ–º–µ—Ü-—Å–∏–º—É–ª—è—Ç–æ—Ä</title>
  <style>
    :root{
      --bg:#0f1220;
      --panel:#171a2b;
      --panel2:#1e2238;
      --text:#e9ecff;

      --hunger:#ff9b2f;      /* –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --sleep:#7ec8ff;       /* —Å–≤–µ—Ç–ª–æ—Å–∏–Ω–∏–π */
      --mood:#ffe28a;        /* –Ω–µ–∂–Ω–æ–∂—ë–ª—Ç—ã–π */
      --clean:#eaf7ff;       /* –≥–æ–ª—É–±–æ–≤–∞—Ç–æ-–±–µ–ª—ã–π */

      --ring-bg: rgba(255,255,255,.10);
      --hud-bg: rgba(0,0,0,.22);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 30% 10%, #20254a 0%, var(--bg) 55%);
      color:var(--text);
      display:flex;
      min-height:100vh;
    }

    .wrap{
      width:min(1100px, 96vw);
      margin:auto;
      display:grid;
      grid-template-columns: 1fr 340px;
      gap:14px;
      padding:14px 0;
    }

    /* –°—Ü–µ–Ω–∞ */
    .scene{
      position:relative;
      background: linear-gradient(180deg, #1a1f3a 0%, #12152a 100%);
      border-radius:16px;
      overflow:hidden;
      min-height:520px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    .ground{
      position:absolute;
      left:0; right:0; bottom:0;
      height:140px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      pointer-events:none;
    }

    /* –ü–∏—Ç–æ–º–µ—Ü (1500x750) */
    .pet{
      position:absolute;
      bottom:135px;             /* –Ω–∞–¥ HUD/–∑–µ–º–ª—ë–π */
      width:260px;              /* –∫–ª—é—á: –∑–∞–¥–∞—ë–º —à–∏—Ä–∏–Ω—É, –≤—ã—Å–æ—Ç–∞ –∞–≤—Ç–æ => –Ω–µ —Å–∂–∏–º–∞–µ—Ç */
      height:auto;
      image-rendering:auto;
      user-select:none;
      -webkit-user-drag:none;
      transform-origin: 50% 50%;
      filter:none;              /* –±–µ–∑ –æ–±–≤–æ–¥–æ–∫/—Ñ–∏–ª—å—Ç—Ä–æ–≤ */
    }

    /* HUD –∫—Ä—É–∂–∫–∏ –≤–Ω–∏–∑—É —Å—Ü–µ–Ω—ã */
    .hud{
      position:absolute;
      left:0; right:0; bottom:0;
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      padding:14px;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--hud-bg) 70%, rgba(0,0,0,.30) 100%);
      pointer-events:none;
    }

    .ring{
      width:74px;
      height:74px;
      border-radius:50%;
      position:relative;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      /* —Ñ–æ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –±—É–¥–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ style="background: conic-gradient(...)" */
    }

    .ring::after{
      content:"";
      position:absolute;
      inset:8px;
      border-radius:50%;
      background: rgba(18,21,42,.95);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }

    .ringInner{
      position:relative;
      z-index:1;
      text-align:center;
      line-height:1.05;
      font-variant-numeric: tabular-nums;
    }
    .ringInner .val{ font-weight:800; font-size:14px; }
    .ringInner .lab{ font-size:10px; opacity:.9; margin-top:3px; }

    /* –ü–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞ */
    .ui{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .card{
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%);
      border-radius:16px;
      padding:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
    }
    .title{
      font-weight:700;
      margin:0 0 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .money{
      font-variant-numeric: tabular-nums;
      opacity:.95;
      background: rgba(255,255,255,.06);
      padding:4px 8px;
      border-radius:999px;
    }

    .btnRow{ display:flex; gap:8px; flex-wrap:wrap; }

    button{
      border:0;
      border-radius:12px;
      padding:10px 10px;
      background: rgba(255,255,255,.08);
      color:var(--text);
      cursor:pointer;
      font-weight:600;
      transition: transform .06s ease, background .12s ease, opacity .12s ease;
      user-select:none;
    }
    button:hover{ background: rgba(255,255,255,.12); }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.45; cursor:not-allowed; }

    .shop{
      display:grid;
      grid-template-columns:1fr;
      gap:8px;
    }
    .shopItem{
      background: rgba(255,255,255,.06);
      border-radius:14px;
      padding:10px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
    }
    .shopItem small{opacity:.85; display:block; line-height:1.35}
    .price{ font-variant-numeric: tabular-nums; opacity:.95; }

    .toast{
      margin-top:8px;
      font-size:13px;
      opacity:.92;
      min-height:18px;
    }

    /* –ú—è—á–∏–∫ */
    .ball{
      position:absolute;
      width:20px;
      height:20px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(255,255,255,.25));
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
      pointer-events:none;
      opacity:0;
      transform: translate(-50%, -50%);
    }

    @media (max-width: 940px){
      .wrap{ grid-template-columns: 1fr; padding:14px 0 24px; }
      .scene{ min-height:420px; }
      .pet{ width:220px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="scene" id="scene">
      <img class="pet" id="pet" src="walk.png" alt="pet" />
      <div class="ball" id="ball"></div>

      <!-- –ö—Ä—É–∂–∫–∏-—Å—Ç–∞—Ç—ã —Å–Ω–∏–∑—É —Å—Ü–µ–Ω—ã -->
      <div class="hud" id="hud">
        <div class="ring" id="ringH"><div class="ringInner"><div class="val" id="hVal">‚Äî</div><div class="lab">–≥–æ–ª–æ–¥</div></div></div>
        <div class="ring" id="ringS"><div class="ringInner"><div class="val" id="sVal">‚Äî</div><div class="lab">—Å–æ–Ω</div></div></div>
        <div class="ring" id="ringM"><div class="ringInner"><div class="val" id="mVal">‚Äî</div><div class="lab">–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div></div></div>
        <div class="ring" id="ringC"><div class="ringInner"><div class="val" id="cVal">‚Äî</div><div class="lab">—á–∏—Å—Ç–æ—Ç–∞</div></div></div>
      </div>

      <div class="ground"></div>
    </div>

    <div class="ui">
      <div class="card">
        <h3 class="title">
          –ü–∏—Ç–æ–º–µ—Ü
          <span class="money">üí∞ <span id="money">30</span></span>
        </h3>
        <div class="toast" id="toast"></div>
        <div style="font-size:12px; opacity:.85; line-height:1.35;">
          –¢–µ–ø–µ—Ä—å –ø–∏—Ç–æ–º–µ—Ü —Å–∞–º —Ä–µ—à–∞–µ—Ç: —Å—Ç–æ—è—Ç—å –∏–ª–∏ –∏–¥—Ç–∏. –ò–≥—Ä—ã –ø–æ–≤—ã—à–∞—é—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –Ω–æ –ø–∞—á–∫–∞—é—Ç.
        </div>
      </div>

      <div class="card">
        <h3 class="title">–ò–≥—Ä–∞—Ç—å</h3>
        <div class="btnRow">
          <button id="petBtn">ü§ö –ü–æ–≥–ª–∞–¥–∏—Ç—å</button>
          <button id="ballBtn">üéæ –ë—Ä–æ—Å–∏—Ç—å –º—è—á–∏–∫</button>
        </div>
      </div>

      <div class="card">
        <h3 class="title">–ú–∞–≥–∞–∑–∏–Ω –µ–¥—ã</h3>
        <div class="shop" id="shop"></div>
      </div>
    </div>
  </div>

  <script>
    // ---------- –£—Ç–∏–ª–∏—Ç—ã ----------
    const clamp = (v, a=0, b=100) => Math.max(a, Math.min(b, v));
    const pct = v => `${Math.round(v)}%`;

    // ---------- –°–æ—Å—Ç–æ—è–Ω–∏–µ ----------
    const state = {
      money: 30,
      stats: { hunger: 65, sleep: 70, mood: 60, clean: 75 },

      // –¥–≤–∏–∂–µ–Ω–∏–µ
      petX: 80,
      dir: 1,                 // 1 –≤–ø—Ä–∞–≤–æ, -1 –≤–ª–µ–≤–æ
      speed: 90,              // px/—Å–µ–∫ (–∫–æ–≥–¥–∞ –∏–¥—ë—Ç)

      // –ø–æ–≤–µ–¥–µ–Ω–∏–µ
      mode: "idle",            // "idle" | "walk"
      modeTimer: 0,            // —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –æ—Å—Ç–∞–ª–æ—Å—å –≤ —Ç–µ–∫—É—â–µ–º —Ä–µ–∂–∏–º–µ

      decay: { hunger: 1.2, sleep: 0.7, mood: 0.5, clean: 0.6 }
    };

    // ---------- –ï–¥–∞ (3 –≤–∏–¥–∞) ----------
    const foods = [
      { id:"kibble", name:"–°—É—Ö–æ–π –∫–æ—Ä–º", price:6,  desc:"+18 –≥–æ–ª–æ–¥, -3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
        effect:s => { s.hunger += 18; s.mood -= 3; } },
      { id:"fish",   name:"–†—ã–±–∫–∞",      price:10, desc:"+22 –≥–æ–ª–æ–¥, +6 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, -4 —á–∏—Å—Ç–æ—Ç–∞",
        effect:s => { s.hunger += 22; s.mood += 6; s.clean -= 4; } },
      { id:"treat",  name:"–õ–∞–∫–æ–º—Å—Ç–≤–æ",  price:8,  desc:"+10 –≥–æ–ª–æ–¥, +14 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
        effect:s => { s.hunger += 10; s.mood += 14; } },
    ];

    // ---------- DOM ----------
    const scene = document.getElementById("scene");
    const pet = document.getElementById("pet");
    const ball = document.getElementById("ball");

    const moneyEl = document.getElementById("money");
    const toastEl = document.getElementById("toast");

    const ringH = document.getElementById("ringH");
    const ringS = document.getElementById("ringS");
    const ringM = document.getElementById("ringM");
    const ringC = document.getElementById("ringC");

    const hVal = document.getElementById("hVal");
    const sVal = document.getElementById("sVal");
    const mVal = document.getElementById("mVal");
    const cVal = document.getElementById("cVal");

    const petBtn = document.getElementById("petBtn");
    const ballBtn = document.getElementById("ballBtn");
    const shopEl = document.getElementById("shop");

    // ---------- –ú–∞–≥–∞–∑–∏–Ω ----------
    function buildShop(){
      shopEl.innerHTML = "";
      for(const item of foods){
        const row = document.createElement("div");
        row.className = "shopItem";
        row.innerHTML = `
          <div>
            <div style="font-weight:700">${item.name}</div>
            <small>${item.desc}</small>
          </div>
          <div style="display:flex; flex-direction:column; gap:6px; align-items:flex-end">
            <div class="price">üí∞ ${item.price}</div>
            <button data-buy="${item.id}">–ö—É–ø–∏—Ç—å</button>
          </div>
        `;
        shopEl.appendChild(row);
      }

      shopEl.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-buy]");
        if(!btn) return;
        buyFood(btn.getAttribute("data-buy"));
      });
    }

    // ---------- –°–æ–æ–±—â–µ–Ω–∏—è ----------
    let toastTimer = 0;
    function toast(msg){
      toastEl.textContent = msg;
      toastTimer = 2.2;
    }

    // ---------- –≠—Ñ—Ñ–µ–∫—Ç—ã ----------
    function applyEffects(fn){
      fn(state.stats);
      for(const k of Object.keys(state.stats)) state.stats[k] = clamp(state.stats[k]);
      renderUI();
    }

    function buyFood(id){
      const item = foods.find(f => f.id === id);
      if(!item) return;
      if(state.money < item.price){ toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç ü•≤"); return; }
      state.money -= item.price;
      applyEffects(item.effect);
      toast(`${item.name}: –≤–∫—É—Å–Ω–æ!`);
    }

    function petAction(){
      applyEffects(s => { s.mood += 12; s.sleep += 3; s.clean -= 2; });
      toast("–ü–æ–≥–ª–∞–¥–∏–ª–∏ ‚ú®");
    }

    function throwBall(){
      applyEffects(s => { s.mood += 18; s.sleep -= 5; s.clean -= 5; });
      toast("–ü–æ–±–µ–≥–∞–ª–∏! üéæ");

      // –∞–Ω–∏–º–∞—Ü–∏—è –º—è—á–∞
      const rect = scene.getBoundingClientRect();
      const startX = rect.width * 0.20;
      const endX   = rect.width * 0.80;
      const y      = rect.height * 0.38;

      ball.style.opacity = "1";
      const t0 = performance.now();
      const duration = 650;

      function anim(t){
        const p = Math.min(1, (t - t0)/duration);
        const x = startX + (endX - startX) * p;
        const arc = Math.sin(Math.PI * p);
        const yy = y - arc * 90;

        ball.style.left = x + "px";
        ball.style.top  = yy + "px";

        if(p < 1) requestAnimationFrame(anim);
        else ball.style.opacity = "0";
      }
      requestAnimationFrame(anim);

      // —á—É—Ç—å —á–∞—â–µ –Ω–∞—á–∏–Ω–∞–µ–º –∏–¥—Ç–∏ –ø–æ—Å–ª–µ –∏–≥—Ä—ã (–∫–∞–∫ –±—É–¥—Ç–æ –≤–æ–∑–±—É–¥–∏–ª—Å—è)
      setMode("walk", 0.8 + Math.random()*1.2, 1);
    }

    petBtn.addEventListener("click", petAction);
    ballBtn.addEventListener("click", throwBall);

    // ---------- –ö—Ä—É–∂–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ ----------
    function setRing(el, value01, color){
      const deg = Math.round(clamp(value01,0,100) * 3.6);
      el.style.background = `conic-gradient(${color} ${deg}deg, var(--ring-bg) 0deg)`;
    }

    function renderUI(){
      moneyEl.textContent = state.money;

      const s = state.stats;
      hVal.textContent = pct(s.hunger);
      sVal.textContent = pct(s.sleep);
      mVal.textContent = pct(s.mood);
      cVal.textContent = pct(s.clean);

      setRing(ringH, s.hunger, "var(--hunger)");
      setRing(ringS, s.sleep,  "var(--sleep)");
      setRing(ringM, s.mood,   "var(--mood)");
      setRing(ringC, s.clean,  "var(--clean)");

      const exhausted = (s.hunger <= 5 || s.sleep <= 5);
      petBtn.disabled = exhausted;
      ballBtn.disabled = exhausted;
      if(exhausted) toast("–ü–∏—Ç–æ–º—Ü—É —Å—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ –ø–æ–µ—Å—Ç—å –∏–ª–∏ –ø–æ—Å–ø–∞—Ç—å!");
    }

    // ---------- –†–∞–∑–º–µ—Ä –ø–∏—Ç–æ–º—Ü–∞ –∏ –≥—Ä–∞–Ω–∏—Ü—ã ----------
    function getPetWidthPx(){
      // –±–µ—Ä–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Ç–µ–∫—É—â—É—é —à–∏—Ä–∏–Ω—É –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      return pet.getBoundingClientRect().width || 260;
    }

    function clampPetX(){
      const rect = scene.getBoundingClientRect();
      const margin = 18;
      const w = getPetWidthPx();
      const maxX = rect.width - w - margin;
      state.petX = clamp(state.petX, margin, maxX);
      return { margin, maxX };
    }

    function renderPet(){
      const { margin, maxX } = clampPetX();

      pet.style.left = state.petX + "px";
      // —Ä–∞–∑–≤–æ—Ä–æ—Ç (–±–µ–∑ –æ–±–≤–æ–¥–æ–∫)
      pet.style.transform = `scaleX(${state.dir})`;

      // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –∑–∞–∂–∞–ª–∏ ‚Äî –ø–µ—Ä–µ–æ–±—Ä–µ–∂–µ–º –∏ –ø–æ–º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      if(state.petX <= margin) state.dir = 1;
      if(state.petX >= maxX) state.dir = -1;
    }

    // ---------- –†–∞–Ω–¥–æ–º–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ----------
    function setMode(mode, seconds, dir = state.dir){
      state.mode = mode;
      state.modeTimer = Math.max(0.2, seconds);
      state.dir = dir;
    }

    function decideNextMode(){
      // —á—É—Ç—å –ª–æ–≥–∏–∫–∏: –µ—Å–ª–∏ –≥–æ–ª–æ–¥/—Å–æ–Ω –ø–ª–æ—Ö–∏–µ ‚Äî –º–µ–Ω—å—à–µ –±–µ–≥–∞–µ–º
      const s = state.stats;
      const tired = (s.sleep < 25);
      const grumpy = (s.mood < 25);

      // –±–∞–∑–æ–≤—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
      let pWalk = 0.55;
      let pIdle = 0.45;

      if(tired) { pWalk -= 0.20; pIdle += 0.20; }
      if(grumpy){ pWalk -= 0.10; pIdle += 0.10; }
      pWalk = clamp(pWalk*100, 0, 100)/100;
      pIdle = 1 - pWalk;

      const r = Math.random();
      if(r < pIdle){
        setMode("idle", 0.7 + Math.random()*2.2);
      } else {
        const dir = Math.random() < 0.5 ? -1 : 1;
        setMode("walk", 0.6 + Math.random()*2.0, dir);
      }
    }

    // ---------- –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ----------
    let last = performance.now();

    function tick(now){
      const dt = Math.min(0.05, (now - last)/1000);
      last = now;

      // —Å—Ç–∞—Ç—ã –ø–∞–¥–∞—é—Ç
      const s = state.stats;
      s.hunger -= state.decay.hunger * dt;
      s.sleep  -= state.decay.sleep  * dt;
      s.mood   -= state.decay.mood   * dt;
      s.clean  -= state.decay.clean  * dt;

      if(s.clean < 35) s.mood -= 0.35 * dt;

      for(const k of Object.keys(s)) s[k] = clamp(s[k]);

      // –ø–æ–≤–µ–¥–µ–Ω–∏–µ: —Ç–∞–π–º–µ—Ä —Ä–µ–∂–∏–º–∞
      state.modeTimer -= dt;
      if(state.modeTimer <= 0) decideNextMode();

      // –¥–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ walk
      if(state.mode === "walk"){
        state.petX += state.speed * state.dir * dt;
      }

      // —Ç–æ—Å—Ç
      if(toastTimer > 0){
        toastTimer -= dt;
        if(toastTimer <= 0) toastEl.textContent = "";
      }

      renderPet();
      renderUI();
      requestAnimationFrame(tick);
    }

    // ---------- –°—Ç–∞—Ä—Ç ----------
    buildShop();
    renderUI();

    // —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–Ω–µ –Ω–∞—á–∏–Ω–∞–µ–º —Å—Ä–∞–∑—É –∏–¥—Ç–∏ –≤—Å–µ–≥–¥–∞)
    setMode("idle", 1.0 + Math.random()*1.5);

    pet.addEventListener("load", () => {
      // –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ç–æ—á–Ω–æ –∑–Ω–∞–µ–º —à–∏—Ä–∏–Ω—É –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Ç–∞–≤–∏–º –≥—Ä–∞–Ω–∏—Ü—ã
      renderPet();
    });
    pet.addEventListener("error", () => {
      toast("–ù–µ –Ω–∞–π–¥–µ–Ω walk.png —Ä—è–¥–æ–º —Å index.html");
    });

    window.addEventListener("resize", renderPet);

    requestAnimationFrame(tick);
  </script>
</body>
</html>

